# Deployment pentru procesul chainsync al bjjbackend (populează DB-ul /data/chainsync.sqlite).
apiVersion: apps/v1
kind: Deployment
metadata:
  name: deployment-bjjbackend-chainsync
  namespace: bjj
spec: # Specificația Deployment-ului
  replicas: 1 # O singură replică pentru jobul chainsync
  selector: # Selectează pods-urile gestionate
    matchLabels:
      app: bjjbackend-chainsync-pod-label # Etichetă folosită și în template
  template: # Template-ul de Pod pentru replici
    metadata:
      labels:
        app: bjjbackend-chainsync-pod-label # Etichetă pentru selectare
    spec: # Specificația Pod-ului
      dnsPolicy: ClusterFirst
      dnsConfig:
        options:
          - name: ndots
            value: "1"
          - name: single-request-reopen
          - name: timeout
            value: "2"
          - name: attempts
            value: "3"
      containers: # Lista containerelor din Pod
        - name: container-bjjbackend-chainsync
          image: mariusgeorgescu/bjj-chainsync # Imaginea containerului (tag în overlay)
          imagePullPolicy: IfNotPresent # Politica de pull
          envFrom: # Variabile de mediu din ConfigMap
            - configMapRef:
                name: configmap-bjjbackend # ConfigMap referit
            - secretRef:
                name: secret-bjjbackend # Secret cu variabile sensibile
          ports:
            - name: http
              containerPort: 8084
          readinessProbe:
            httpGet:
              path: /ready
              port: http
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 5
            timeoutSeconds: 2
            failureThreshold: 3
          livenessProbe:
            httpGet:
              path: /health
              port: http
              scheme: HTTP
          initialDelaySeconds: 25
          periodSeconds: 10
          timeoutSeconds: 3
          failureThreshold: 3
          startupProbe:
            httpGet:
              path: /ready
              port: http
            periodSeconds: 10
            timeoutSeconds: 3
            failureThreshold: 600
