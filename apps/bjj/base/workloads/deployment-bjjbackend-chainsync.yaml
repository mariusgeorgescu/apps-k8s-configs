# Deployment pentru jobul chainsync (gestionează populația DB /data/chainsync.sqlite).
apiVersion: apps/v1 # Versiunea API pentru Deployment
kind: Deployment # Tipul resursei este Deployment
metadata: # Metadate Kubernetes
  name: deployment-bjjbackend-chainsync # Numele Deployment-ului
  namespace: bjj # Namespace-ul în care se creează
spec: # Specificația Deployment-ului
  replicas: 1 # O singură replică pentru jobul chainsync
  selector: # Selectează pods-urile gestionate
    matchLabels:
      app: bjjbackend-chainsync-pod-label # Etichetă folosită și în template
  template: # Template-ul de Pod pentru replici
    metadata: # Metadate ale Pod-ului
      labels:
        app: bjjbackend-chainsync-pod-label # Etichetă pentru selectare
    spec: # Specificația Pod-ului
      dnsConfig: # Configurația DNS pentru Pod
        options:
        - name: ndots
          value: "1"
      containers: # Lista containerelor din Pod
      - name: container-bjjbackend-chainsync # Numele containerului
        image: mariusgeorgescu/chainsync:chainsync # Imaginea containerului
        imagePullPolicy: IfNotPresent # Politica de pull
        envFrom: # Variabile de mediu din ConfigMap
        - configMapRef:
            name: configmap-bjjbackend # ConfigMap referit
        volumeMounts: # Montări de volume în container
        - name: lookup-db # Numele volumului
          mountPath: /data # Calea în container unde e montat PVC-ul
      volumes: # Volume disponibile în Pod
      - name: lookup-db # Numele volumului
        persistentVolumeClaim:
          claimName: pvc-bjjbackend-lookup # Referința către PVC
