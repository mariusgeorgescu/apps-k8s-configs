# HTTPRoute principal pentru traficul HTTPS către bjjbackend.
apiVersion: gateway.networking.k8s.io/v1  
kind: HTTPRoute # Tipul resursei este HTTPRoute
metadata:   
  name: httproute-bjjbackend-api # Numele rutei către backend
  namespace: bjj 
spec: # Specificația rutei  
  parentRefs: # Gateway/Listener părinte
  - name: prod-gateway-bjjbackend-api # Gateway-ul prod cu prefix
    sectionName: https # Listener-ul HTTPS pe portul 443
  hostnames: # Domeniile pentru care se aplică ruta
  - bjjbackend.cardano.vip # Domeniul aplicației
  rules: # Reguli de rutare
  - matches: # Rutează direct către UI-ul Swagger al interaction API
    - path:
        type: PathPrefix # Potrivire pe calea /swagger-ui
        value: /swagger-ui
    backendRefs: # Trimite direct către serviciul interaction API
    - name: prod-service-bjjbackend-interaction-api # Service-ul interaction API
      port: 8082 # Portul backendului
  - matches: # Tipare de potrivire pentru cereri
    - path:
        type: PathPrefix # Tipul de potrivire pe cale
        value: /build-tx # Toate căile
    - path:
        type: PathPrefix # Tipul de potrivire pe cale
        value: /submit-tx # Toate căile
    backendRefs: # Backendurile către care se forwardează traficul
    - name: prod-service-bjjbackend-interaction-api # Numele Service-ului backend cu prefix
      port: 8082 # Portul backendului
  - matches: # Redirectează la /swagger-ui pentru compatibilitate
    - path:
        type: PathPrefix # Potrivire pe cale
        value: /interaction/swagger-ui # Endpoint accesat de utilizatori
    filters:
    - type: RequestRedirect
      requestRedirect:
        statusCode: 301
        path:
          type: ReplaceFullPath
          replaceFullPath: /swagger-ui
  - matches: # Tipare de potrivire pentru cereri
    - path:
        type: PathPrefix # Tipul de potrivire pe cale
        value: /query/swagger-ui # Swagger UI pentru query API
    backendRefs: # Backendurile către care se forwardează traficul
    - name: prod-service-bjjbackend-query-api # Service-ul query API
      port: 8083 # Portul backendului
  - matches: # Tipare de potrivire pentru cereri
    - path:
        type: PathPrefix # Tipul de potrivire pe cale
        value: / # Toate căile
    backendRefs: # Backendurile către care se forwardează traficul
    - name: prod-service-bjjbackend-query-api # Numele Service-ului backend cu prefix
      port: 8083 # Portul backendului
