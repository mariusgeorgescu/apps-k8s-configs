{{- if or .Values.mongo.enabled .Values.mongo.host -}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ template "orchestration_delivery.fullname" . }}-spring
  labels:
    {{- include "orchestration_delivery.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.mongo.auth.enabled }}
  spring-db: {{ printf "{\"spring\": {\"data\": {\"mongodb\": { \"uri\": \"mongodb://%s:%s@%s:27017/orchestration_delivery?replicaSet=rs0&authSource=orchestration_delivery\", \"database\": \"orchestration_delivery\", \"host\": \"%s\", \"port\": 27017, \"authentication-database\": \"orchestration_delivery\", \"username\": \"%s\", \"password\": \"%s\"}}}}"  (.Values.mongo.auth.rootUser) (.Values.mongo.auth.rootPassword) (.Values.mongo.service.nameOverride) (.Values.mongo.service.nameOverride) (.Values.mongo.auth.rootUser) (.Values.mongo.auth.rootPassword) | b64enc }}
  {{- else }}
  spring-db: {{ printf "{\"spring\": {\"data\": {\"mongodb\": { \"uri\": \"mongodb://%s:27017/orchestration_delivery?replicaSet=rs0\", \"database\": \"orchestration_delivery\"}}}}" (.Values.mongo.service.nameOverride) | b64enc }}
  {{- end }}
{{- end }}
